import{a as B,c as T,d as D,e as j,f as N,g as q,n as H,p as O}from"./chunk-OYOJ2XX2.js";import{a as G}from"./chunk-NHNZC5T7.js";import{c as k,e as z}from"./chunk-KFQQY7Q4.js";import{a as P}from"./chunk-SNFTPR3R.js";import"./chunk-ZS4G4JJV.js";import"./chunk-4QFA7BNO.js";import{$a as v,Aa as f,Oa as S,Qa as p,Rb as A,Ua as t,Va as i,Wa as b,Wb as L,Za as _,_ as w,_a as d,eb as r,fb as g,ha as c,hb as C,ia as m,ja as x,jb as F,ka as E,kb as I,lb as V,nb as M,za as l}from"./chunk-CZ4BJCOO.js";function R(o,h){if(o&1&&(t(0,"div",19)(1,"h3",20),r(2),i(),t(3,"p",21),r(4),i(),t(5,"p",22),r(6),i()()),o&2){let e=v();l(2),g(e.offer.title),l(2),g(e.offer.companyName),l(2),C("",e.offer.location," \u2022 ",e.offer.duration," mois")}}function W(o,h){if(o&1){let e=_();t(0,"div",23),d("click",function(){c(e);let n=v();return m(n.triggerFileInput())}),x(),t(1,"svg",24),b(2,"path",25),i(),E(),t(3,"p",26)(4,"span",27),r(5,"Cliquez pour t\xE9l\xE9charger"),i(),r(6," ou glissez-d\xE9posez "),i(),t(7,"p",28),r(8,"PDF jusqu'\xE0 5MB"),i()()}}function K(o,h){if(o&1){let e=_();t(0,"div",29),x(),t(1,"svg",30),b(2,"path",31),i(),E(),t(3,"div")(4,"p",32),r(5),i(),t(6,"p",28),r(7),i()(),t(8,"button",33),d("click",function(){c(e);let n=v();return m(n.removeFile())}),x(),t(9,"svg",34),b(10,"path",35),i()()()}if(o&2){let e=v();l(5),g(e.selectedFile.name),l(2),g(e.formatFileSize(e.selectedFile.size))}}function J(o,h){o&1&&(t(0,"span"),r(1,"Envoyer ma candidature"),i())}function Q(o,h){o&1&&(t(0,"span"),r(1,"Envoi en cours..."),i())}var ne=(()=>{class o{constructor(e,a,n,s){this.route=e,this.router=a,this.apiService=n,this.notificationService=s,this.offer=null,this.selectedFile=null,this.isSubmitting=!1,this.applicationData={coverLetter:""}}ngOnInit(){this.offerId=Number(this.route.snapshot.paramMap.get("id")),this.loadOffer()}loadOffer(){this.apiService.getOfferById(this.offerId).subscribe({next:e=>{this.offer=e},error:e=>{this.notificationService.showError("Offre non trouv\xE9e"),this.router.navigate(["/offers"])}})}triggerFileInput(){document.getElementById("cv")?.click()}onFileSelected(e){let a=e.target.files[0];if(a){if(a.type!=="application/pdf"){this.notificationService.showError("Seuls les fichiers PDF sont accept\xE9s");return}if(a.size>5*1024*1024){this.notificationService.showError("Le fichier ne doit pas d\xE9passer 5MB");return}this.selectedFile=a}}removeFile(){this.selectedFile=null;let e=document.getElementById("cv");e&&(e.value="")}formatFileSize(e){if(e===0)return"0 Bytes";let a=1024,n=["Bytes","KB","MB"],s=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,s)).toFixed(2))+" "+n[s]}isFormValid(){return this.applicationData.coverLetter.length>=100&&this.selectedFile!==null}submitApplication(){!this.isFormValid()||this.isSubmitting||(this.isSubmitting=!0,this.apiService.submitApplication(this.offerId,this.applicationData.coverLetter,this.selectedFile).subscribe({next:()=>{this.notificationService.showSuccess("Candidature envoy\xE9e avec succ\xE8s !"),this.router.navigate(["/student/applications"])},error:e=>{e.status===409?this.notificationService.showError("Vous avez d\xE9j\xE0 postul\xE9 \xE0 cette offre"):this.notificationService.showError("Erreur lors de l'envoi"),this.isSubmitting=!1}}))}goBack(){this.router.navigate(["/offers"])}static{this.\u0275fac=function(a){return new(a||o)(f(k),f(z),f(P),f(G))}}static{this.\u0275cmp=w({type:o,selectors:[["app-submit-application"]],standalone:!0,features:[M],decls:28,vars:7,consts:[["applicationForm","ngForm"],[1,"max-w-4xl","mx-auto","space-y-6"],[1,"bg-white","rounded-lg","shadow-sm","border","p-6"],[1,"text-2xl","font-bold","text-primary-900"],["class","mt-4 p-4 bg-gray-50 rounded-lg",4,"ngIf"],[3,"ngSubmit"],[1,"mb-6"],["for","coverLetter",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","coverLetter","name","coverLetter","required","","rows","8","placeholder","Expliquez pourquoi vous \xEAtes int\xE9ress\xE9 par cette offre et ce que vous pouvez apporter \xE0 l'entreprise...",1,"w-full","border","border-gray-300","rounded-md","px-3","py-2","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"text-sm","text-gray-500","mt-1"],["for","cv",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"border-2","border-dashed","border-gray-300","rounded-lg","p-6","text-center"],["type","file","id","cv","name","cv","accept",".pdf","required","",1,"hidden",3,"change"],["class","cursor-pointer",3,"click",4,"ngIf"],["class","flex items-center justify-center space-x-2",4,"ngIf"],[1,"flex","justify-between","items-center"],["type","button",1,"px-6","py-2","border","border-gray-300","text-gray-700","rounded-md","hover:bg-gray-50",3,"click"],["type","submit",1,"px-6","py-2","bg-primary-600","text-white","rounded-md","hover:bg-primary-700","disabled:opacity-50",3,"disabled"],[4,"ngIf"],[1,"mt-4","p-4","bg-gray-50","rounded-lg"],[1,"font-semibold","text-lg"],[1,"text-gray-600"],[1,"text-sm","text-gray-500","mt-2"],[1,"cursor-pointer",3,"click"],["stroke","currentColor","fill","none","viewBox","0 0 48 48",1,"mx-auto","h-12","w-12","text-gray-400"],["d","M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"mt-2","text-sm","text-gray-600"],[1,"font-medium","text-primary-600"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","justify-center","space-x-2"],["fill","currentColor","viewBox","0 0 20 20",1,"h-8","w-8","text-red-500"],["fill-rule","evenodd","d","M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z","clip-rule","evenodd"],[1,"text-sm","font-medium","text-gray-900"],["type","button",1,"text-red-500","hover:text-red-700",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"h-5","w-5"],["fill-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule","evenodd"]],template:function(a,n){if(a&1){let s=_();t(0,"div",1)(1,"div",2)(2,"h1",3),r(3,"Postuler \xE0 l'offre"),i(),S(4,R,7,4,"div",4),i(),t(5,"div",2)(6,"form",5,0),d("ngSubmit",function(){return c(s),m(n.submitApplication())}),t(8,"div",6)(9,"label",7),r(10," Lettre de motivation * "),i(),t(11,"textarea",8),V("ngModelChange",function(u){return c(s),I(n.applicationData.coverLetter,u)||(n.applicationData.coverLetter=u),m(u)}),r(12,"            "),i(),t(13,"p",9),r(14,"Minimum 100 caract\xE8res"),i()(),t(15,"div",6)(16,"label",10),r(17," CV (PDF uniquement) * "),i(),t(18,"div",11)(19,"input",12),d("change",function(u){return c(s),m(n.onFileSelected(u))}),i(),S(20,W,9,0,"div",13)(21,K,11,2,"div",14),i()(),t(22,"div",15)(23,"button",16),d("click",function(){return c(s),m(n.goBack())}),r(24," Retour "),i(),t(25,"button",17),S(26,J,2,0,"span",18)(27,Q,2,0,"span",18),i()()()()()}a&2&&(l(4),p("ngIf",n.offer),l(7),F("ngModel",n.applicationData.coverLetter),l(9),p("ngIf",!n.selectedFile),l(),p("ngIf",n.selectedFile),l(4),p("disabled",!n.isFormValid()||n.isSubmitting),l(),p("ngIf",!n.isSubmitting),l(),p("ngIf",n.isSubmitting))},dependencies:[L,A,O,q,B,T,D,H,N,j],encapsulation:2})}}return o})();export{ne as SubmitApplicationComponent};
