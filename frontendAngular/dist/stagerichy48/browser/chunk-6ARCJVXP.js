import{a as V}from"./chunk-NHNZC5T7.js";import{c as N,f as k}from"./chunk-KFQQY7Q4.js";import{a as R}from"./chunk-KMK3IRKM.js";import{a as P}from"./chunk-AY7NQNNI.js";import"./chunk-SNFTPR3R.js";import"./chunk-ZS4G4JJV.js";import"./chunk-4QFA7BNO.js";import{$a as l,Aa as m,Oa as g,Pb as S,Qa as d,Qb as A,Rb as T,Ua as o,Va as r,Wa as C,Wb as D,Za as v,_ as y,_a as _,eb as s,fb as E,gb as h,ha as f,ia as x,ja as b,ka as w,nb as I,za as a}from"./chunk-CZ4BJCOO.js";var u=function(i){return i.PENDING="PENDING",i.VIEWED="VIEWED",i.ACCEPTED="ACCEPTED",i.REJECTED="REJECTED",i.AWAITING_AGREEMENT="AWAITING_AGREEMENT",i}(u||{});function j(i,p){i&1&&(o(0,"div",8),C(1,"div",9),r())}function G(i,p){i&1&&(o(0,"div",13)(1,"h3",14),s(2,"Aucune candidature"),r(),o(3,"p",15),s(4,"Aucune candidature n'a \xE9t\xE9 re\xE7ue pour vos offres."),r()())}function L(i,p){if(i&1){let e=v();o(0,"button",28),_("click",function(){f(e);let n=l().$implicit,c=l(2);return x(c.downloadCV(n))}),s(1," T\xE9l\xE9charger CV "),r()}}function F(i,p){if(i&1){let e=v();o(0,"button",29),_("click",function(){f(e);let n=l().$implicit,c=l(2);return x(c.updateStatus(n,c.ApplicationStatus.ACCEPTED))}),s(1," Accepter "),r()}}function M(i,p){if(i&1){let e=v();o(0,"button",30),_("click",function(){f(e);let n=l().$implicit,c=l(2);return x(c.updateStatus(n,c.ApplicationStatus.REJECTED))}),s(1," Refuser "),r()}}function O(i,p){if(i&1&&(o(0,"div",16)(1,"div",17)(2,"div",18)(3,"h3",19),s(4),r(),o(5,"p",20),s(6),r(),o(7,"p",21),s(8),r(),o(9,"div",22)(10,"span"),s(11),r(),o(12,"span",23),s(13),r()()(),o(14,"div",24),g(15,L,2,0,"button",25)(16,F,2,0,"button",26)(17,M,2,0,"button",27),r()()()),i&2){let e=p.$implicit,t=l(2);a(4),E(e.studentName),a(2),E(e.offerTitle),a(2),E(e.coverLetter),a(3),h("Candidature du ",t.formatDate(e.applicationDate),""),a(),d("ngClass",t.getStatusClass(e.status)),a(),h(" ",t.getStatusLabel(e.status)," "),a(2),d("ngIf",e.cvPath),a(),d("ngIf",e.status==="PENDING"),a(),d("ngIf",e.status==="PENDING")}}function $(i,p){if(i&1&&(o(0,"div",10),g(1,G,5,0,"div",11)(2,O,18,9,"div",12),r()),i&2){let e=l();a(),d("ngIf",e.applications.length===0),a(),d("ngForOf",e.applications)}}var Y=(()=>{class i{constructor(e,t,n,c){this.applicationService=e,this.notificationService=t,this.agreementService=n,this.route=c,this.applications=[],this.loading=!1,this.offerId=null,this.ApplicationStatus=u}ngOnInit(){this.route.queryParams.subscribe(e=>{this.offerId=e.offerId?parseInt(e.offerId):null,this.loadApplications()})}loadApplications(){this.loading=!0,this.applicationService.getCompanyApplications(0,50,this.offerId||void 0).subscribe({next:e=>{this.applications=e.content||e||[],this.loading=!1},error:e=>{console.error("Error loading applications:",e),this.notificationService.showError("Erreur lors du chargement des candidatures"),this.loading=!1}})}updateStatus(e,t){this.applicationService.updateApplicationStatus(e.id,{status:t}).subscribe({next:()=>{e.status=t,t===u.ACCEPTED&&this.createAgreement(e),this.notificationService.showSuccess(`Candidature ${t===u.ACCEPTED?"accept\xE9e":"refus\xE9e"}`)},error:n=>{console.error("Error updating status:",n),this.notificationService.showError("Erreur lors de la mise \xE0 jour")}})}createAgreement(e){let t={applicationId:e.id,studentId:e.studentId,companyId:e.companyId,offerId:e.offerId};this.agreementService.createAgreement(t).subscribe({next:n=>{console.log("Convention cr\xE9\xE9e:",n),this.notificationService.showSuccess("Convention de stage cr\xE9\xE9e automatiquement")},error:n=>{console.error("Erreur lors de la cr\xE9ation de la convention:",n),this.notificationService.showError("Erreur lors de la cr\xE9ation de la convention")}})}downloadCV(e){this.applicationService.downloadCV(e.id).subscribe({next:t=>{let n=window.URL.createObjectURL(t),c=document.createElement("a");c.href=n,c.download=`CV_${e.studentName}.pdf`,c.click(),window.URL.revokeObjectURL(n)},error:t=>{console.error("Error downloading CV:",t),this.notificationService.showError("Erreur lors du t\xE9l\xE9chargement du CV")}})}getStatusClass(e){return{PENDING:"bg-yellow-100 text-yellow-800",ACCEPTED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"}getStatusLabel(e){return{PENDING:"En attente",ACCEPTED:"Accept\xE9e",REJECTED:"Refus\xE9e"}[e]||e}formatDate(e){let t=new Date(e);return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"short",day:"numeric"}).format(t)}static{this.\u0275fac=function(t){return new(t||i)(m(R),m(V),m(P),m(N))}}static{this.\u0275cmp=y({type:i,selectors:[["app-company-applications"]],standalone:!0,features:[I],decls:10,vars:2,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"mb-6"],["routerLink","/company",1,"inline-flex","items-center","text-primary-600","hover:text-primary-800"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-3xl","font-bold","text-gray-900","mb-6"],["class","flex justify-center py-8",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"flex","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-primary-600"],[1,"space-y-4"],["class","bg-white rounded-lg shadow p-8 text-center",4,"ngIf"],["class","bg-white rounded-lg shadow-md p-6",4,"ngFor","ngForOf"],[1,"bg-white","rounded-lg","shadow","p-8","text-center"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500"],[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-600","mb-2"],[1,"text-sm","text-gray-500","mb-4"],[1,"flex","items-center","space-x-4","text-sm","text-gray-500"],[1,"px-2","py-1","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"flex","space-x-2","ml-4"],["class","px-3 py-1.5 text-xs font-medium text-primary-600 border border-primary-600 rounded-md hover:bg-primary-50",3,"click",4,"ngIf"],["class","px-3 py-1.5 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700",3,"click",4,"ngIf"],["class","px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",3,"click",4,"ngIf"],[1,"px-3","py-1.5","text-xs","font-medium","text-primary-600","border","border-primary-600","rounded-md","hover:bg-primary-50",3,"click"],[1,"px-3","py-1.5","text-xs","font-medium","text-white","bg-green-600","rounded-md","hover:bg-green-700",3,"click"],[1,"px-3","py-1.5","text-xs","font-medium","text-white","bg-red-600","rounded-md","hover:bg-red-700",3,"click"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"a",2),b(),o(3,"svg",3),C(4,"path",4),r(),s(5," Back to Dashboard "),r()(),w(),o(6,"h1",5),s(7,"Candidatures re\xE7ues"),r(),g(8,j,2,0,"div",6)(9,$,3,2,"div",7),r()),t&2&&(a(8),d("ngIf",n.loading),a(),d("ngIf",!n.loading))},dependencies:[D,S,A,T,k],encapsulation:2})}}return i})();export{Y as CompanyApplicationsComponent};
