import{a as n}from"./chunk-SX46PIGY.js";import{a as g}from"./chunk-SNFTPR3R.js";import{M as s,P as u,U as c,k as a,o as t,z as o}from"./chunk-CZ4BJCOO.js";var I=(()=>{class i{constructor(e){this.apiService=e,this.currentUserSubject=new a(null),this.tokenKey="auth_token",this.userIdKey="user_id",this.userRoleKey="user_role",this.currentUser$=this.currentUserSubject.asObservable(),console.log("\u{1F510} AuthService initialized"),this.loadUserFromStorage()}loadUserFromStorage(){console.log("\u{1F4F1} Loading user from localStorage...");let e=localStorage.getItem(this.tokenKey),r=localStorage.getItem(this.userIdKey),l=localStorage.getItem(this.userRoleKey);console.log("\u{1F50D} Storage check:",{hasToken:!!e,userId:r,userRole:l,tokenPreview:e?e.substring(0,20)+"...":null}),e&&r&&l?(console.log("\u2705 User found in storage, creating session"),this.currentUserSubject.next({id:parseInt(r),role:l,firstName:"",lastName:"",email:"",enabled:!0,createdAt:"",updatedAt:""})):console.log("\u274C No valid user session found")}login(e){return console.log("\u{1F511} Attempting login for:",e.email),this.apiService.post("/auth/login",e).pipe(s(r=>{console.log("\u2705 Login successful:",{userId:r.userId,role:r.role}),this.handleAuthResponse(r)}),o(r=>(console.error("\u274C Login failed:",r),t(()=>new Error(r.error||"Login failed. Please check your credentials.")))))}registerStudent(e){return this.apiService.post("/auth/register/student",e).pipe(s(r=>this.handleAuthResponse(r)),o(r=>(console.error("Student registration error:",r),t(()=>new Error(r.error||"Registration failed. Please try again.")))))}registerCompany(e){return this.apiService.post("/auth/register/company",e).pipe(s(r=>this.handleAuthResponse(r)),o(r=>(console.error("Company registration error:",r),t(()=>new Error(r.error||"Registration failed. Please try again.")))))}registerSchool(e){return this.apiService.post("/auth/register/school",e).pipe(s(r=>this.handleAuthResponse(r)),o(r=>(console.error("School registration error:",r),t(()=>new Error(r.error||"Registration failed. Please try again.")))))}getUserProfile(){return this.apiService.get("/users/me").pipe(s(e=>{this.currentUserSubject.next(e)}),o(e=>(console.error("Get user profile error:",e),t(()=>new Error("Failed to load user profile.")))))}logout(){console.log("\u{1F6AA} Logging out user"),localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.userIdKey),localStorage.removeItem(this.userRoleKey),this.currentUserSubject.next(null),console.log("\u2705 Logout complete")}changePassword(e,r){return this.apiService.post("/users/change-password",{currentPassword:e,newPassword:r})}isLoggedIn(){return!!localStorage.getItem(this.tokenKey)}getToken(){return localStorage.getItem(this.tokenKey)}hasRole(e){return localStorage.getItem(this.userRoleKey)===e}isStudent(){return this.hasRole(n.STUDENT)}isCompany(){return this.hasRole(n.COMPANY)}isFaculty(){return this.hasRole(n.FACULTY)}isAdmin(){return this.hasRole(n.ADMIN)}getCurrentUser(){return this.currentUserSubject.value}getCurrentUserId(){let e=localStorage.getItem(this.userIdKey);return e?parseInt(e):null}getCurrentUserRole(){return localStorage.getItem(this.userRoleKey)||null}handleAuthResponse(e){console.log("\u{1F4BE} Saving auth data to localStorage:",{userId:e.userId,role:e.role,tokenLength:e.token.length}),localStorage.setItem(this.tokenKey,e.token),localStorage.setItem(this.userIdKey,e.userId.toString()),localStorage.setItem(this.userRoleKey,e.role),this.loadUserFromStorage()}static{this.\u0275fac=function(r){return new(r||i)(c(g))}}static{this.\u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{I as a};
