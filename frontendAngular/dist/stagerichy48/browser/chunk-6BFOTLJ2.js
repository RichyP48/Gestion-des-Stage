import{a as N,c as V,d as I,e as W,f as T,g as D,n as F,p as A}from"./chunk-OYOJ2XX2.js";import{a as k}from"./chunk-YRUNILEP.js";import{a as j}from"./chunk-GDEHS6TE.js";import"./chunk-SX46PIGY.js";import"./chunk-SNFTPR3R.js";import"./chunk-ZS4G4JJV.js";import"./chunk-4QFA7BNO.js";import{Aa as y,Qa as w,Ua as i,Va as o,Wb as E,Za as C,_ as v,_a as _,db as x,eb as l,fb as S,ha as d,hb as M,ia as p,jb as s,kb as f,lb as u,n as h,nb as P,z as b,za as a}from"./chunk-CZ4BJCOO.js";var H=(()=>{class g{constructor(n,e){this.userService=n,this.authService=e,this.profile={nom:"",prenom:"",email:"",telephone:"",role:"STUDENT"},console.log("\u{1F464} StudentProfileComponent initialized")}ngOnInit(){this.loadProfile()}loadProfile(){console.log("\u{1F4C4} Loading user profile...");let n=this.authService.getCurrentUser();if(!n){console.error("\u274C No authenticated user found");return}console.log("\u{1F464} Current user from auth:",n),this.userService.getCurrentUser().pipe(b(e=>(console.error("\u274C Error loading profile from API:",e),h({id:n.id,firstName:n.firstName||"",lastName:n.lastName||"",email:n.email||"",role:n.role,phoneNumber:"",enabled:!0,createdAt:"",updatedAt:""})))).subscribe({next:e=>{console.log("\u2705 Profile loaded successfully:",e),this.profile={id:e.id,nom:e.lastName||"",prenom:e.firstName||"",email:e.email||"",telephone:e.phoneNumber||"",role:e.role},console.log("\u{1F4DD} Profile data mapped:",this.profile)},error:e=>{console.error("\u274C Unexpected error loading profile:",e)}})}saveProfile(){if(console.log("\u{1F4BE} Saving profile...",this.profile),!this.profile.id){console.error("\u274C No profile ID found"),alert("Erreur: ID utilisateur manquant");return}let n={firstName:this.profile.prenom,lastName:this.profile.nom,email:this.profile.email,telephone:this.profile.phoneNumber};console.log("\u{1F4E4} Sending update data:",n),this.userService.updateProfile(n).pipe(b(e=>(console.error("\u274C Error saving profile via API:",e),alert("Erreur lors de la sauvegarde du profil. Veuillez r\xE9essayer."),h(null)))).subscribe({next:e=>{e&&(console.log("\u2705 Profile saved successfully:",e),alert("Profil mis \xE0 jour avec succ\xE8s!"),this.profile={id:e.id,nom:e.lastName||"",prenom:e.firstName||"",email:e.email||"",telephone:e.phoneNumber||"",role:e.role},console.log("\u{1F504} Profile updated locally:",this.profile))},error:e=>{console.error("\u274C Unexpected error saving profile:",e)}})}get userInitials(){return`${this.profile.prenom?.[0]||""}${this.profile.nom?.[0]||""}`.toUpperCase()}static{this.\u0275fac=function(e){return new(e||g)(y(k),y(j))}}static{this.\u0275cmp=v({type:g,selectors:[["app-student-profile"]],standalone:!0,features:[P],decls:39,vars:9,consts:[["profileForm","ngForm"],[1,"space-y-6"],[1,"bg-white","rounded-lg","shadow-sm","border","p-6"],[1,"text-2xl","font-bold","text-primary-900"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"text-center"],[1,"w-32","h-32","bg-primary-600","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-3xl","font-bold","text-white"],[1,"text-lg","font-semibold","text-primary-900"],[1,"text-sm","text-gray-600"],[1,"lg:col-span-2","bg-white","rounded-lg","shadow-sm","border","p-6"],[1,"text-lg","font-semibold","text-primary-900","mb-4"],[3,"ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700"],["name","prenom","required","",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","px-3","py-2",3,"ngModelChange","ngModel"],["name","nom","required","",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","px-3","py-2",3,"ngModelChange","ngModel"],["name","email","type","email","required","",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","px-3","py-2",3,"ngModelChange","ngModel"],["name","telephone",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","px-3","py-2",3,"ngModelChange","ngModel"],[1,"flex","justify-end","mt-6"],["type","submit",1,"bg-primary-600","text-white","px-6","py-2","rounded-md","hover:bg-primary-700","disabled:opacity-50",3,"disabled"]],template:function(e,r){if(e&1){let m=C();i(0,"div",1)(1,"div",2)(2,"h1",3),l(3,"Mon profil"),o()(),i(4,"div",4)(5,"div",2)(6,"div",5)(7,"div",6)(8,"span",7),l(9),o()(),i(10,"h3",8),l(11),o(),i(12,"p",9),l(13),o()()(),i(14,"div",10)(15,"h2",11),l(16,"Informations personnelles"),o(),i(17,"form",12,0),_("ngSubmit",function(){return d(m),p(r.saveProfile())}),i(19,"div",13)(20,"div")(21,"label",14),l(22,"Pr\xE9nom"),o(),i(23,"input",15),u("ngModelChange",function(t){return d(m),f(r.profile.prenom,t)||(r.profile.prenom=t),p(t)}),o()(),i(24,"div")(25,"label",14),l(26,"Nom"),o(),i(27,"input",16),u("ngModelChange",function(t){return d(m),f(r.profile.nom,t)||(r.profile.nom=t),p(t)}),o()(),i(28,"div")(29,"label",14),l(30,"Email"),o(),i(31,"input",17),u("ngModelChange",function(t){return d(m),f(r.profile.email,t)||(r.profile.email=t),p(t)}),o()(),i(32,"div")(33,"label",14),l(34,"T\xE9l\xE9phone"),o(),i(35,"input",18),u("ngModelChange",function(t){return d(m),f(r.profile.telephone,t)||(r.profile.telephone=t),p(t)}),o()()(),i(36,"div",19)(37,"button",20),l(38," Sauvegarder "),o()()()()()()}if(e&2){let m=x(18);a(9),S(r.userInitials),a(2),M("",r.profile.prenom," ",r.profile.nom,""),a(2),S(r.profile.role),a(10),s("ngModel",r.profile.prenom),a(4),s("ngModel",r.profile.nom),a(4),s("ngModel",r.profile.email),a(4),s("ngModel",r.profile.telephone),a(2),w("disabled",!m.form.valid)}},dependencies:[E,A,D,N,V,I,F,T,W]})}}return g})();export{H as StudentProfileComponent};
