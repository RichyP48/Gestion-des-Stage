import{a as L}from"./chunk-NHNZC5T7.js";import{f as V}from"./chunk-KFQQY7Q4.js";import{a as M}from"./chunk-AY7NQNNI.js";import"./chunk-SNFTPR3R.js";import"./chunk-ZS4G4JJV.js";import"./chunk-4QFA7BNO.js";import{$a as l,Aa as A,Oa as p,Pb as I,Qa as s,Qb as w,Rb as N,Ua as n,Ub as P,Va as t,Wa as g,Wb as T,Za as C,_ as h,_a as E,eb as o,fb as b,gb as u,ha as _,ia as S,ja as x,ka as v,nb as D,rb as f,tb as y,za as r}from"./chunk-CZ4BJCOO.js";function B(i,d){i&1&&(n(0,"div",8),g(1,"div",9),t())}function O(i,d){i&1&&(n(0,"div",13)(1,"h3",14),o(2,"Aucune convention"),t(),n(3,"p",15),o(4,"Aucune convention de stage n'est disponible."),t()())}function R(i,d){if(i&1&&(n(0,"span",31),o(1),f(2,"date"),t()),i&2){let e=l().$implicit;r(),u("(",y(2,1,e.studentSignatureDate,"dd/MM"),")")}}function F(i,d){if(i&1&&(n(0,"span",31),o(1),f(2,"date"),t()),i&2){let e=l().$implicit;r(),u("(",y(2,1,e.companySignatureDate,"dd/MM"),")")}}function k(i,d){if(i&1&&(n(0,"span",31),o(1),f(2,"date"),t()),i&2){let e=l().$implicit;r(),u("(",y(2,1,e.facultyValidationDate,"dd/MM"),")")}}function G(i,d){if(i&1&&(n(0,"span",31),o(1),f(2,"date"),t()),i&2){let e=l().$implicit;r(),u("(",y(2,1,e.adminApprovalDate,"dd/MM"),")")}}function j(i,d){if(i&1){let e=C();n(0,"button",32),E("click",function(){_(e);let m=l().$implicit,c=l(2);return S(c.signAgreement(m))}),o(1," Signer "),t()}}function U(i,d){if(i&1){let e=C();n(0,"div",16)(1,"div",17)(2,"div")(3,"h3",18),o(4),t(),n(5,"p",19),o(6),t()(),n(7,"span",20),o(8),t()(),n(9,"div",21)(10,"p",22),o(11,"Approbations & Signatures"),t(),n(12,"div",23)(13,"div",24),x(),n(14,"svg",25),g(15,"path",26),t(),v(),n(16,"span",19),o(17,"\xC9tudiant"),t(),p(18,R,3,4,"span",27),t(),n(19,"div",24),x(),n(20,"svg",25),g(21,"path",26),t(),v(),n(22,"span",19),o(23,"Entreprise"),t(),p(24,F,3,4,"span",27),t(),n(25,"div",24),x(),n(26,"svg",25),g(27,"path",26),t(),v(),n(28,"span",19),o(29,"Facult\xE9"),t(),p(30,k,3,4,"span",27),t(),n(31,"div",24),x(),n(32,"svg",25),g(33,"path",26),t(),v(),n(34,"span",19),o(35,"Administration"),t(),p(36,G,3,4,"span",27),t()()(),n(37,"div",28)(38,"button",29),E("click",function(){let m=_(e).$implicit,c=l(2);return S(c.downloadPDF(m))}),o(39," T\xE9l\xE9charger PDF "),t(),p(40,j,2,0,"button",30),t()()}if(i&2){let e=d.$implicit,a=l(2);r(4),b(e.offerTitle),r(2),u("\xC9tudiant: ",e.studentName,""),r(),s("ngClass",a.getStatusClass(e.status)),r(),u(" ",a.getStatusLabel(e.status)," "),r(6),s("ngClass",a.getApprovalStatus(e,"student")?"text-green-500":"text-gray-300"),r(4),s("ngIf",e.studentSignatureDate),r(2),s("ngClass",a.getApprovalStatus(e,"company")?"text-green-500":"text-gray-300"),r(4),s("ngIf",e.companySignatureDate),r(2),s("ngClass",a.getApprovalStatus(e,"faculty")?"text-green-500":"text-gray-300"),r(4),s("ngIf",e.facultyValidationDate),r(2),s("ngClass",a.getApprovalStatus(e,"admin")?"text-green-500":"text-gray-300"),r(4),s("ngIf",e.adminApprovalDate),r(4),s("ngIf",!e.signedByCompany)}}function $(i,d){if(i&1&&(n(0,"div",10),p(1,O,5,0,"div",11)(2,U,41,13,"div",12),t()),i&2){let e=l();r(),s("ngIf",e.agreements.length===0),r(),s("ngForOf",e.agreements)}}var K=(()=>{class i{constructor(e,a){this.agreementService=e,this.notificationService=a,this.agreements=[],this.loading=!1}ngOnInit(){this.loadAgreements()}loadAgreements(){this.loading=!0,this.agreementService.getCompanyAgreements(0,50).subscribe({next:e=>{this.agreements=e.content||e||[],this.loading=!1},error:e=>{console.error("Error loading agreements:",e),this.notificationService.showError("Erreur lors du chargement des conventions"),this.loading=!1,this.agreements=[{id:1,offerTitle:"Stage D\xE9veloppement Web",studentName:"Jean Dupont",status:"PENDING_FACULTY_VALIDATION",signedByStudent:!0,signedByCompany:!1,signedByFaculty:!1,approvedByAdmin:!1,studentSignatureDate:"2024-01-15",companySignatureDate:void 0,facultyValidationDate:void 0,adminApprovalDate:void 0},{id:2,offerTitle:"Stage Marketing Digital",studentName:"Marie Martin",status:"PENDING_ADMIN_APPROVAL",signedByStudent:!0,signedByCompany:!1,signedByFaculty:!0,approvedByAdmin:!1,studentSignatureDate:"2024-01-10",companySignatureDate:void 0,facultyValidationDate:"2024-01-14",adminApprovalDate:void 0}]}})}signAgreement(e){this.agreementService.signAgreementAsCompany(e.id).subscribe({next:a=>{e.signedByCompany=!0,e.companySignatureDate=new Date,this.notificationService.showSuccess("Convention sign\xE9e avec succ\xE8s par l'entreprise"),this.loadAgreements()},error:a=>{console.error("Error signing agreement:",a),this.notificationService.showError("Erreur lors de la signature de la convention")}})}downloadPDF(e){this.agreementService.downloadAgreementPdf(e.id).subscribe({next:a=>{let m=window.URL.createObjectURL(a),c=document.createElement("a");c.href=m,c.download=`convention-${e.id}.pdf`,c.click(),window.URL.revokeObjectURL(m)},error:a=>{console.error("Error downloading PDF:",a),this.notificationService.showError("Erreur lors du t\xE9l\xE9chargement")}})}getStatusClass(e){return{PENDING_FACULTY_VALIDATION:"bg-yellow-100 text-yellow-800",PENDING_ADMIN_APPROVAL:"bg-blue-100 text-blue-800",APPROVED:"bg-green-100 text-green-800",SIGNED:"bg-purple-100 text-purple-800",REJECTED:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"}getStatusLabel(e){return{PENDING_FACULTY_VALIDATION:"En attente validation",PENDING_ADMIN_APPROVAL:"En attente approbation",APPROVED:"Approuv\xE9e",SIGNED:"Sign\xE9e",REJECTED:"Rejet\xE9e"}[e]||e}getApprovalStatus(e,a){switch(a){case"student":return e.signedByStudent||!1;case"company":return e.signedByCompany||!1;case"faculty":return e.signedByFaculty||e.status==="PENDING_ADMIN_APPROVAL"||e.status==="APPROVED"||!1;case"admin":return e.approvedByAdmin||e.status==="APPROVED"||!1;default:return!1}}canSignAgreement(e){return e.signedByStudent&&(e.status==="PENDING_FACULTY_VALIDATION"||e.status==="PENDING_ADMIN_APPROVAL"||e.status==="APPROVED")}static{this.\u0275fac=function(a){return new(a||i)(A(M),A(L))}}static{this.\u0275cmp=h({type:i,selectors:[["app-company-agreements"]],standalone:!0,features:[D],decls:10,vars:2,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"mb-6"],["routerLink","/company",1,"inline-flex","items-center","text-primary-600","hover:text-primary-800"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-3xl","font-bold","text-gray-900","mb-6"],["class","flex justify-center py-8",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"flex","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-primary-600"],[1,"space-y-4"],["class","bg-white rounded-lg shadow p-8 text-center",4,"ngIf"],["class","bg-white rounded-lg shadow-md p-6",4,"ngFor","ngForOf"],[1,"bg-white","rounded-lg","shadow","p-8","text-center"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500"],[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"flex","justify-between","items-start","mb-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"px-3","py-1","rounded-full","text-sm",3,"ngClass"],[1,"mb-4"],[1,"text-sm","font-medium","text-gray-700","mb-2"],[1,"grid","grid-cols-2","gap-4"],[1,"flex","items-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","mr-2",3,"ngClass"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],["class","text-xs text-gray-500 ml-1",4,"ngIf"],[1,"flex","space-x-2"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-md","hover:bg-primary-700","text-sm",3,"click"],["class","bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 text-sm",3,"click",4,"ngIf"],[1,"text-xs","text-gray-500","ml-1"],[1,"bg-green-600","text-white","px-4","py-2","rounded-md","hover:bg-green-700","text-sm",3,"click"]],template:function(a,m){a&1&&(n(0,"div",0)(1,"div",1)(2,"a",2),x(),n(3,"svg",3),g(4,"path",4),t(),o(5," Retour au tableau de bord "),t()(),v(),n(6,"h1",5),o(7,"Conventions de stage"),t(),p(8,B,2,0,"div",6)(9,$,3,2,"div",7),t()),a&2&&(r(8),s("ngIf",m.loading),r(),s("ngIf",!m.loading))},dependencies:[T,I,w,N,P,V],encapsulation:2})}}return i})();export{K as CompanyAgreementsComponent};
