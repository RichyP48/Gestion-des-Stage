import{a as d}from"./chunk-ZS4G4JJV.js";import{b as u}from"./chunk-4QFA7BNO.js";import{P as c,U as f,a,b as r,k as s}from"./chunk-CZ4BJCOO.js";var v=(()=>{class n{constructor(t){this.http=t,this.notifications$=new s([]),this.unreadCount$=new s(0),this.apiUrl=d.apiUrl}getNotifications(){return this.notifications$.asObservable()}getUnreadCount(){return this.unreadCount$.asObservable()}showSuccess(t){this.addNotification("success",t)}showError(t){this.addNotification("error",t)}showWarning(t){this.addNotification("warning",t)}showInfo(t){this.addNotification("info",t)}addNotification(t,i){let e={id:Date.now().toString(),type:t,message:i,timestamp:new Date,read:!1},o=this.notifications$.value,h=[e,...o];this.notifications$.next(h),this.updateUnreadCount(),t==="success"&&setTimeout(()=>{this.removeNotification(e.id)},5e3)}markAsRead(t){let i=this.notifications$.value.map(e=>e.id===t?r(a({},e),{read:!0}):e);this.notifications$.next(i),this.updateUnreadCount()}markAllAsRead(){let t=this.notifications$.value.map(i=>r(a({},i),{read:!0}));this.notifications$.next(t),this.updateUnreadCount()}removeNotification(t){let i=this.notifications$.value.filter(e=>e.id!==t);this.notifications$.next(i),this.updateUnreadCount()}clearAll(){this.notifications$.next([]),this.unreadCount$.next(0)}updateUnreadCount(){let t=this.notifications$.value.filter(i=>!i.read).length;this.unreadCount$.next(t)}getServerNotifications(t=0,i=10){return this.http.get(`${this.apiUrl}/notifications?page=${t}&size=${i}`)}getServerUnreadCount(){return this.http.get(`${this.apiUrl}/notifications/unread-count`)}markServerNotificationAsRead(t){return this.http.put(`${this.apiUrl}/notifications/${t}/read`,{})}markAllServerNotificationsAsRead(){return this.http.put(`${this.apiUrl}/notifications/mark-all-read`,{})}deleteServerNotification(t){return this.http.delete(`${this.apiUrl}/notifications/${t}`)}loadServerNotifications(){this.getServerNotifications().subscribe({next:t=>{let e=(t.content||t).map(o=>({id:o.id.toString(),type:this.mapServerTypeToLocal(o.type),message:o.message,timestamp:new Date(o.createdAt),read:o.read,link:o.link}));this.notifications$.next(e),this.updateUnreadCount()},error:t=>{console.error("Error loading server notifications:",t)}})}mapServerTypeToLocal(t){switch(t){case"AGREEMENT_VALIDATED":case"APPLICATION_ACCEPTED":return"success";case"AGREEMENT_REJECTED":case"APPLICATION_REJECTED":return"error";case"AGREEMENT_ACTION_REQUIRED":return"warning";default:return"info"}}static{this.\u0275fac=function(i){return new(i||n)(f(u))}}static{this.\u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{v as a};
