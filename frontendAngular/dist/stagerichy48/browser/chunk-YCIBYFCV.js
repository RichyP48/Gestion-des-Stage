import{a as L}from"./chunk-NHNZC5T7.js";import"./chunk-KFQQY7Q4.js";import{a as B}from"./chunk-AY7NQNNI.js";import{a as F}from"./chunk-GDEHS6TE.js";import"./chunk-SX46PIGY.js";import"./chunk-SNFTPR3R.js";import"./chunk-ZS4G4JJV.js";import"./chunk-4QFA7BNO.js";import{$a as l,Aa as _,Oa as p,Pb as P,Qa as s,Qb as N,Rb as T,Ua as n,Ub as V,Va as i,Wa as x,Wb as M,Za as A,_ as I,_a as D,eb as o,fb as y,gb as S,ha as E,ia as h,ja as v,ka as f,n as C,nb as w,rb as u,tb as g,z as b,za as r}from"./chunk-CZ4BJCOO.js";function O(a,m){a&1&&(n(0,"div",5),v(),n(1,"svg",6),x(2,"path",7),i(),f(),n(3,"h3",8),o(4,"Aucune convention"),i(),n(5,"p",9),o(6,"Vos conventions de stage appara\xEEtront ici une fois cr\xE9\xE9es."),i()())}function k(a,m){if(a&1&&(n(0,"span",29),o(1),u(2,"date"),i()),a&2){let e=l().$implicit;r(),S("(",g(2,1,e.studentSignatureDate,"dd/MM"),")")}}function R(a,m){if(a&1&&(n(0,"span",29),o(1),u(2,"date"),i()),a&2){let e=l().$implicit;r(),S("(",g(2,1,e.companySignatureDate,"dd/MM"),")")}}function G(a,m){if(a&1&&(n(0,"span",29),o(1),u(2,"date"),i()),a&2){let e=l().$implicit;r(),S("(",g(2,1,e.facultyValidationDate,"dd/MM"),")")}}function j(a,m){if(a&1&&(n(0,"span",29),o(1),u(2,"date"),i()),a&2){let e=l().$implicit;r(),S("(",g(2,1,e.adminApprovalDate,"dd/MM"),")")}}function U(a,m){if(a&1){let e=A();n(0,"button",30),D("click",function(){E(e);let d=l().$implicit,c=l(2);return h(c.signAgreement(d))}),o(1," Signer "),i()}}function $(a,m){if(a&1){let e=A();n(0,"div",12)(1,"div",13)(2,"div")(3,"h3",14),o(4),i(),n(5,"p",15),o(6),i()(),n(7,"span",16),o(8),i()(),n(9,"div",17)(10,"div")(11,"p",18),o(12,"Date de d\xE9but"),i(),n(13,"p",15),o(14),u(15,"date"),i()(),n(16,"div")(17,"p",18),o(18,"Date de fin"),i(),n(19,"p",15),o(20),u(21,"date"),i()()(),n(22,"div",19)(23,"p",20),o(24,"Approbations & Signatures"),i(),n(25,"div",21)(26,"div",22),v(),n(27,"svg",23),x(28,"path",24),i(),f(),n(29,"span",15),o(30,"\xC9tudiant"),i(),p(31,k,3,4,"span",25),i(),n(32,"div",22),v(),n(33,"svg",23),x(34,"path",24),i(),f(),n(35,"span",15),o(36,"Entreprise"),i(),p(37,R,3,4,"span",25),i(),n(38,"div",22),v(),n(39,"svg",23),x(40,"path",24),i(),f(),n(41,"span",15),o(42,"Facult\xE9"),i(),p(43,G,3,4,"span",25),i(),n(44,"div",22),v(),n(45,"svg",23),x(46,"path",24),i(),f(),n(47,"span",15),o(48,"Administration"),i(),p(49,j,3,4,"span",25),i()()(),n(50,"div",26)(51,"button",27),D("click",function(){let d=E(e).$implicit,c=l(2);return h(c.downloadPDF(d))}),o(52," T\xE9l\xE9charger PDF "),i(),p(53,U,2,0,"button",28),i()()}if(a&2){let e=m.$implicit,t=l(2);r(4),y(e.offerTitle),r(2),y(e.companyName),r(),s("ngClass",t.getStatusClass(e.status)),r(),S(" ",t.getStatusLabel(e.status)," "),r(6),y(g(15,15,e.startDate,"dd/MM/yyyy")),r(6),y(g(21,18,e.endDate,"dd/MM/yyyy")),r(7),s("ngClass",t.getApprovalStatus(e,"student")?"text-green-500":"text-gray-300"),r(4),s("ngIf",e.studentSignatureDate),r(2),s("ngClass",t.getApprovalStatus(e,"company")?"text-green-500":"text-gray-300"),r(4),s("ngIf",e.companySignatureDate),r(2),s("ngClass",t.getApprovalStatus(e,"faculty")?"text-green-500":"text-gray-300"),r(4),s("ngIf",e.facultyValidationDate),r(2),s("ngClass",t.getApprovalStatus(e,"admin")?"text-green-500":"text-gray-300"),r(4),s("ngIf",e.adminApprovalDate),r(4),s("ngIf",t.canStudentSign(e))}}function H(a,m){if(a&1&&(n(0,"div",10),p(1,$,54,21,"div",11),i()),a&2){let e=l();r(),s("ngForOf",e.agreements)}}var Z=(()=>{class a{constructor(e,t,d){this.agreementService=e,this.authService=t,this.notificationService=d,this.agreements=[],console.log("\u{1F4DC} StudentAgreementsComponent initialized")}ngOnInit(){this.loadAgreements()}loadAgreements(){console.log("\u{1F4C4} Loading student agreements...");let e=this.authService.getCurrentUser();if(!e){console.error("\u274C No authenticated user found");return}console.log("\u{1F464} Loading agreements for user:",e.id),this.agreementService.getStudentAgreements(0,50).subscribe({next:t=>{console.log("\u2705 Agreements loaded successfully:",t);let d=this.agreements.length;this.agreements=t.content||t,console.log("\u{1F4CA} Total agreements:",this.agreements.length),this.checkForStatusChanges(d)},error:t=>{console.error("\u274C Error loading agreements:",t),this.notificationService.showError("Erreur lors du chargement des conventions"),this.agreements=[{id:1,offerTitle:"Stage D\xE9veloppement Web",companyName:"TechCorp",startDate:new Date("2024-06-01"),endDate:new Date("2024-08-31"),status:"PENDING_FACULTY_VALIDATION",signedByStudent:!1,signedByCompany:!1,signedByFaculty:!1,approvedByAdmin:!1,studentSignatureDate:void 0,companySignatureDate:void 0,facultyValidationDate:void 0,adminApprovalDate:void 0},{id:2,offerTitle:"Stage Marketing Digital",companyName:"MarketPro",startDate:new Date("2024-07-01"),endDate:new Date("2024-09-30"),status:"APPROVED",signedByStudent:!0,signedByCompany:!0,signedByFaculty:!0,approvedByAdmin:!0,studentSignatureDate:"2024-01-10",companySignatureDate:"2024-01-12",facultyValidationDate:"2024-01-14",adminApprovalDate:"2024-01-16"}]}})}checkForStatusChanges(e){this.notificationService.loadServerNotifications(),this.agreements.length>e&&this.notificationService.showInfo("Nouvelles mises \xE0 jour sur vos conventions"),this.agreements.forEach(t=>{t.status==="PENDING_ADMIN_APPROVAL"?this.notificationService.showSuccess("Votre convention a \xE9t\xE9 valid\xE9e par la facult\xE9"):t.status==="REJECTED"&&this.notificationService.showError("Votre convention a \xE9t\xE9 rejet\xE9e par la facult\xE9")})}signAgreement(e){console.log("\u270D\uFE0F Signing agreement:",e.id),this.agreementService.signAgreement(e.id).subscribe({next:t=>{console.log("\u2705 Agreement signed successfully:",t),e.signedByStudent=!0,e.signedByStudent&&e.signedByCompany&&e.signedByFaculty&&(e.status="SIGNED",console.log("\u{1F389} Agreement fully signed!")),this.notificationService.showSuccess("Convention sign\xE9e avec succ\xE8s"),this.loadAgreements()},error:t=>{console.error("\u274C Error signing agreement:",t),this.notificationService.showError("Erreur lors de la signature de la convention")}})}downloadPDF(e){console.log("\u{1F4CE} Downloading PDF for agreement:",e.id),this.agreementService.downloadAgreementPdf(e.id).pipe(b(t=>(console.error("\u274C Error downloading PDF:",t),alert("Erreur lors du t\xE9l\xE9chargement du PDF. Veuillez r\xE9essayer."),C(null)))).subscribe({next:t=>{if(t){console.log("\u2705 PDF downloaded successfully");let d=window.URL.createObjectURL(t),c=document.createElement("a");c.href=d,c.download=`convention-stage-${e.id}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(d),console.log("\u{1F4CE} PDF download initiated")}},error:t=>{console.error("\u274C Unexpected error downloading PDF:",t)}})}getStatusClass(e){return{DRAFT:"bg-gray-100 text-gray-800",PENDING:"bg-yellow-100 text-yellow-800",SIGNED:"bg-green-100 text-green-800",ACTIVE:"bg-blue-100 text-blue-800",COMPLETED:"bg-purple-100 text-purple-800"}[e]||"bg-gray-100 text-gray-800"}getStatusLabel(e){return{DRAFT:"Brouillon",PENDING:"En attente",PENDING_FACULTY_VALIDATION:"En attente validation facult\xE9",PENDING_ADMIN_APPROVAL:"En attente approbation admin",APPROVED:"Approuv\xE9e",SIGNED:"Sign\xE9e",ACTIVE:"Active",COMPLETED:"Termin\xE9e",REJECTED:"Rejet\xE9e"}[e]||e}getApprovalStatus(e,t){switch(t){case"student":return e.signedByStudent||!1;case"company":return e.signedByCompany||!1;case"faculty":return e.signedByFaculty||e.status==="PENDING_ADMIN_APPROVAL"||e.status==="APPROVED"||!1;case"admin":return e.approvedByAdmin||e.status==="APPROVED"||!1;default:return!1}}canStudentSign(e){return!e.signedByStudent&&(e.status==="PENDING_FACULTY_VALIDATION"||e.status==="PENDING_ADMIN_APPROVAL"||e.status==="APPROVED")}static{this.\u0275fac=function(t){return new(t||a)(_(B),_(F),_(L))}}static{this.\u0275cmp=I({type:a,selectors:[["app-student-agreements"]],standalone:!0,features:[w],decls:7,vars:2,consts:[[1,"space-y-6"],[1,"bg-white","rounded-lg","shadow-sm","border","p-6"],[1,"text-2xl","font-bold","text-primary-900"],["class","text-center py-12",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"text-center","py-12"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-12","w-12","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"mt-2","text-sm","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],[1,"space-y-4"],["class","border border-gray-200 rounded-lg p-6",4,"ngFor","ngForOf"],[1,"border","border-gray-200","rounded-lg","p-6"],[1,"flex","justify-between","items-start","mb-4"],[1,"text-lg","font-semibold","text-primary-900"],[1,"text-sm","text-gray-600"],[1,"px-3","py-1","rounded-full","text-sm",3,"ngClass"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],[1,"text-sm","font-medium","text-gray-700"],[1,"mb-4"],[1,"text-sm","font-medium","text-gray-700","mb-2"],[1,"grid","grid-cols-2","gap-4"],[1,"flex","items-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","mr-2",3,"ngClass"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],["class","text-xs text-gray-500 ml-1",4,"ngIf"],[1,"flex","space-x-2"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-md","hover:bg-primary-700","text-sm",3,"click"],["class","bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 text-sm",3,"click",4,"ngIf"],[1,"text-xs","text-gray-500","ml-1"],[1,"bg-green-600","text-white","px-4","py-2","rounded-md","hover:bg-green-700","text-sm",3,"click"]],template:function(t,d){t&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"Mes conventions de stage"),i()(),n(4,"div",1),p(5,O,7,0,"div",3)(6,H,2,1,"div",4),i()()),t&2&&(r(5),s("ngIf",d.agreements.length===0),r(),s("ngIf",d.agreements.length>0))},dependencies:[M,P,N,T,V]})}}return a})();export{Z as StudentAgreementsComponent};
