import{a as F}from"./chunk-NHNZC5T7.js";import{a as N}from"./chunk-AY7NQNNI.js";import"./chunk-SNFTPR3R.js";import"./chunk-ZS4G4JJV.js";import"./chunk-4QFA7BNO.js";import{$a as c,Aa as x,Oa as _,Qa as d,Qb as I,Rb as S,Ua as r,Ub as E,Va as i,Wa as h,Wb as w,Za as v,_ as y,_a as f,eb as s,gb as g,ha as u,ia as p,nb as b,rb as A,tb as C,za as a}from"./chunk-CZ4BJCOO.js";function T(t,m){t&1&&(r(0,"div",7),h(1,"div",8),i())}function D(t,m){t&1&&(r(0,"div",9)(1,"p",10),s(2,"Aucune convention en attente de validation"),i()())}function k(t,m){if(t&1){let e=v();r(0,"button",23),f("click",function(){u(e);let o=c().$implicit,l=c(2);return p(l.validateAgreement(o.id,!0))}),s(1," Valider "),i()}}function V(t,m){if(t&1){let e=v();r(0,"button",24),f("click",function(){u(e);let o=c().$implicit,l=c(2);return p(l.validateAgreement(o.id,!1))}),s(1," Rejeter "),i()}}function P(t,m){if(t&1){let e=v();r(0,"button",25),f("click",function(){u(e);let o=c().$implicit,l=c(2);return p(l.signAgreement(o))}),s(1," Signer "),i()}}function L(t,m){if(t&1&&(r(0,"div",13)(1,"div",14)(2,"div",15)(3,"h3",16),s(4),i(),r(5,"p",17),s(6),i(),r(7,"p",18),s(8),i(),r(9,"p",18),s(10),i(),r(11,"p",18),s(12),A(13,"date"),i()(),r(14,"div",19),_(15,k,2,0,"button",20)(16,V,2,0,"button",21)(17,P,2,0,"button",22),i()()()),t&2){let e=m.$implicit,n=c(2);a(4),g(" Convention #",e.id," "),a(2),g(" \xC9tudiant: ",e.studentName," "),a(2),g(" Entreprise: ",e.companyName," "),a(2),g(" Poste: ",e.offerTitle," "),a(2),g(" Date de cr\xE9ation: ",C(13,8,e.createdAt,"dd/MM/yyyy")," "),a(3),d("ngIf",e.status==="PENDING_FACULTY_VALIDATION"),a(),d("ngIf",e.status==="PENDING_FACULTY_VALIDATION"),a(),d("ngIf",n.canFacultySign(e))}}function M(t,m){if(t&1&&(r(0,"div",11),_(1,L,18,11,"div",12),i()),t&2){let e=c();a(),d("ngForOf",e.agreements)}}var Y=(()=>{class t{constructor(e,n){this.agreementService=e,this.notificationService=n,this.agreements=[],this.loading=!0}ngOnInit(){console.log("Current user token exists:",!!localStorage.getItem("token")),console.log("Current user role:",localStorage.getItem("userRole")),this.loadPendingAgreements()}loadPendingAgreements(){this.loading=!0,console.log("Loading faculty pending agreements..."),this.agreementService.getFacultyPendingAgreements().subscribe({next:e=>{console.log("Faculty agreements response:",e),this.agreements=e.content||e||[],console.log("Agreements loaded:",this.agreements.length,"agreements"),this.loading=!1,this.agreements.length===0&&console.log("No pending agreements found for this faculty")},error:e=>{console.error("Error loading agreements:",e),console.error("Error status:",e.status),console.error("Error message:",e.message),this.notificationService.showError("Erreur lors du chargement des conventions"),this.loading=!1,this.agreements=[{id:1,studentName:"Jean Dupont",companyName:"TechCorp",offerTitle:"Stage D\xE9veloppement Web",createdAt:"2024-01-15T10:00:00Z",status:"PENDING_FACULTY_VALIDATION"},{id:2,studentName:"Marie Martin",companyName:"MarketPro",offerTitle:"Stage Marketing Digital",createdAt:"2024-01-16T14:30:00Z",status:"PENDING_FACULTY_VALIDATION"}]}})}validateAgreement(e,n){let o=n?void 0:prompt("Raison du rejet:");!n&&!o||this.agreementService.validateAgreement(e,n,o||void 0).subscribe({next:l=>{console.log("Agreement validation response:",l),n?this.notificationService.showSuccess("Convention valid\xE9e avec succ\xE8s"):this.notificationService.showInfo("Convention rejet\xE9e"),this.loadPendingAgreements()},error:l=>{console.error("Error validating agreement:",l),this.notificationService.showError("Erreur lors de la validation de la convention")}})}signAgreement(e){this.agreementService.signAgreement(e.id).subscribe({next:n=>{console.log("Agreement signed by faculty:",n),this.notificationService.showSuccess("Convention sign\xE9e avec succ\xE8s"),this.loadPendingAgreements()},error:n=>{console.error("Error signing agreement:",n),this.notificationService.showError("Erreur lors de la signature")}})}canFacultySign(e){return e.status==="PENDING_ADMIN_APPROVAL"&&!e.signedByFaculty}static{this.\u0275fac=function(n){return new(n||t)(x(N),x(F))}}static{this.\u0275cmp=y({type:t,selectors:[["app-faculty-agreements"]],standalone:!0,features:[b],decls:9,vars:3,consts:[[1,"space-y-6"],[1,"bg-white","rounded-lg","shadow-sm","border","p-6"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-primary-600"],["class","flex justify-center py-8",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"flex","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-primary-600"],[1,"text-center","py-8"],[1,"text-gray-500"],[1,"space-y-4"],["class","bg-white rounded-lg shadow border p-6",4,"ngFor","ngForOf"],[1,"bg-white","rounded-lg","shadow","border","p-6"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"text-sm","text-gray-600"],[1,"flex","space-x-2"],["class","px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm",3,"click",4,"ngIf"],["class","px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-sm",3,"click",4,"ngIf"],["class","px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm",3,"click",4,"ngIf"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","text-sm",3,"click"],[1,"px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","text-sm",3,"click"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","text-sm",3,"click"]],template:function(n,o){n&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),s(3,"Conventions en attente de validation"),i(),r(4,"p",3),s(5,"Validez ou rejetez les conventions de stage de vos \xE9tudiants"),i()(),_(6,T,2,0,"div",4)(7,D,3,0,"div",5)(8,M,2,1,"div",6),i()),n&2&&(a(6),d("ngIf",o.loading),a(),d("ngIf",!o.loading&&o.agreements.length===0),a(),d("ngIf",!o.loading&&o.agreements.length>0))},dependencies:[w,I,S,E],encapsulation:2})}}return t})();export{Y as FacultyAgreementsComponent};
